(()=>{var rr=Object.create;var pe=Object.defineProperty;var ir=Object.getOwnPropertyDescriptor;var nr=Object.getOwnPropertyNames,We=Object.getOwnPropertySymbols,ar=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable;var Je=(i,n,a)=>n in i?pe(i,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[n]=a,ze=(i,n)=>{for(var a in n||(n={}))Ye.call(n,a)&&Je(i,a,n[a]);if(We)for(var a of We(n))sr.call(n,a)&&Je(i,a,n[a]);return i};var or=i=>pe(i,"__esModule",{value:!0});var O=(i,n)=>()=>(n||i((n={exports:{}}).exports,n),n.exports);var cr=(i,n,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of nr(n))!Ye.call(i,s)&&s!=="default"&&pe(i,s,{get:()=>n[s],enumerable:!(a=ir(n,s))||a.enumerable});return i},lr=i=>cr(or(pe(i!=null?rr(ar(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var Y=O((kr,Qe)=>{"use strict";function te(i,n,a,s,m,u){return{tag:i,key:n,attrs:a,children:s,text:m,dom:u,domSize:void 0,state:void 0,events:void 0,instance:void 0}}te.normalize=function(i){return Array.isArray(i)?te("[",void 0,void 0,te.normalizeChildren(i),void 0,void 0):i==null||typeof i=="boolean"?null:typeof i=="object"?i:te("#",void 0,void 0,String(i),void 0,void 0)};te.normalizeChildren=function(i){var n=[];if(i.length){for(var a=i[0]!=null&&i[0].key!=null,s=1;s<i.length;s++)if((i[s]!=null&&i[s].key!=null)!==a)throw new TypeError("Vnodes must either always have keys or never have keys!");for(var s=0;s<i.length;s++)n[s]=te.normalize(i[s])}return n};Qe.exports=te});var Le=O((Ir,Ze)=>{"use strict";var fr=Y();Ze.exports=function(){var i=arguments[this],n=this+1,a;if(i==null?i={}:(typeof i!="object"||i.tag!=null||Array.isArray(i))&&(i={},n=this),arguments.length===n+1)a=arguments[n],Array.isArray(a)||(a=[a]);else for(a=[];n<arguments.length;)a.push(arguments[n++]);return fr("",i.key,i,a)}});var Ve=O((jr,it)=>{"use strict";var et=Y(),ur=Le(),hr=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,tt={},ne={}.hasOwnProperty;function rt(i){for(var n in i)if(ne.call(i,n))return!1;return!0}function pr(i){for(var n,a="div",s=[],m={};n=hr.exec(i);){var u=n[1],h=n[2];if(u===""&&h!=="")a=h;else if(u==="#")m.id=h;else if(u===".")s.push(h);else if(n[3][0]==="["){var f=n[6];f&&(f=f.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),n[4]==="class"?s.push(f):m[n[4]]=f===""?f:f||!0}}return s.length>0&&(m.className=s.join(" ")),tt[i]={tag:a,attrs:m}}function mr(i,n){var a=n.attrs,s=et.normalizeChildren(n.children),m=ne.call(a,"class"),u=m?a.class:a.className;if(n.tag=i.tag,n.attrs=null,n.children=void 0,!rt(i.attrs)&&!rt(a)){var h={};for(var f in a)ne.call(a,f)&&(h[f]=a[f]);a=h}for(var f in i.attrs)ne.call(i.attrs,f)&&f!=="className"&&!ne.call(a,f)&&(a[f]=i.attrs[f]);(u!=null||i.attrs.className!=null)&&(a.className=u!=null?i.attrs.className!=null?String(i.attrs.className)+" "+String(u):u:i.attrs.className!=null?i.attrs.className:null),m&&(a.class=null);for(var f in a)if(ne.call(a,f)&&f!=="key"){n.attrs=a;break}return Array.isArray(s)&&s.length===1&&s[0]!=null&&s[0].tag==="#"?n.text=s[0].children:n.children=s,n}function dr(i){if(i==null||typeof i!="string"&&typeof i!="function"&&typeof i.view!="function")throw Error("The selector must be either a string or a component.");var n=ur.apply(1,arguments);return typeof i=="string"&&(n.children=et.normalizeChildren(n.children),i!=="[")?mr(tt[i]||pr(i),n):(n.tag=i,n)}it.exports=dr});var at=O((Fr,nt)=>{"use strict";var gr=Y();nt.exports=function(i){return i==null&&(i=""),gr("<",void 0,void 0,i,void 0,void 0)}});var ot=O((_r,st)=>{"use strict";var yr=Y(),wr=Le();st.exports=function(){var i=wr.apply(0,arguments);return i.tag="[",i.children=yr.normalizeChildren(i.children),i}});var lt=O((Hr,ct)=>{"use strict";var Ne=Ve();Ne.trust=at();Ne.fragment=ot();ct.exports=Ne});var $e=O((Gr,ft)=>{"use strict";var S=function(i){if(!(this instanceof S))throw new Error("Promise must be called with `new`");if(typeof i!="function")throw new TypeError("executor must be a function");var n=this,a=[],s=[],m=l(a,!0),u=l(s,!1),h=n._instance={resolvers:a,rejectors:s},f=typeof setImmediate=="function"?setImmediate:setTimeout;function l(y,v){return function x(w){var E;try{if(v&&w!=null&&(typeof w=="object"||typeof w=="function")&&typeof(E=w.then)=="function"){if(w===n)throw new TypeError("Promise can't be resolved w/ itself");d(E.bind(w))}else f(function(){!v&&y.length===0&&console.error("Possible unhandled promise rejection:",w);for(var b=0;b<y.length;b++)y[b](w);a.length=0,s.length=0,h.state=v,h.retry=function(){x(w)}})}catch(b){u(b)}}}function d(y){var v=0;function x(E){return function(b){v++>0||E(b)}}var w=x(u);try{y(x(m),w)}catch(E){w(E)}}d(i)};S.prototype.then=function(i,n){var a=this,s=a._instance;function m(l,d,y,v){d.push(function(x){if(typeof l!="function")y(x);else try{u(l(x))}catch(w){h&&h(w)}}),typeof s.retry=="function"&&v===s.state&&s.retry()}var u,h,f=new S(function(l,d){u=l,h=d});return m(i,s.resolvers,u,!0),m(n,s.rejectors,h,!1),f};S.prototype.catch=function(i){return this.then(null,i)};S.prototype.finally=function(i){return this.then(function(n){return S.resolve(i()).then(function(){return n})},function(n){return S.resolve(i()).then(function(){return S.reject(n)})})};S.resolve=function(i){return i instanceof S?i:new S(function(n){n(i)})};S.reject=function(i){return new S(function(n,a){a(i)})};S.all=function(i){return new S(function(n,a){var s=i.length,m=0,u=[];if(i.length===0)n([]);else for(var h=0;h<i.length;h++)(function(f){function l(d){m++,u[f]=d,m===s&&n(u)}i[f]!=null&&(typeof i[f]=="object"||typeof i[f]=="function")&&typeof i[f].then=="function"?i[f].then(l,a):l(i[f])})(h)})};S.race=function(i){return new S(function(n,a){for(var s=0;s<i.length;s++)i[s].then(n,a)})};ft.exports=S});var Se=O((Ur,me)=>{"use strict";var oe=$e();typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=oe:window.Promise.prototype.finally||(window.Promise.prototype.finally=oe.prototype.finally),me.exports=window.Promise):typeof global!="undefined"?(typeof global.Promise=="undefined"?global.Promise=oe:global.Promise.prototype.finally||(global.Promise.prototype.finally=oe.prototype.finally),me.exports=global.Promise):me.exports=oe});var ht=O((Br,ut)=>{"use strict";var ae=Y();ut.exports=function(i){var n=i&&i.document,a,s={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function m(t){return t.attrs&&t.attrs.xmlns||s[t.tag]}function u(t,e){if(t.state!==e)throw new Error("`vnode.state` must not be modified")}function h(t){var e=t.state;try{return this.apply(e,arguments)}finally{u(t,e)}}function f(){try{return n.activeElement}catch(t){return null}}function l(t,e,r,o,c,g,A){for(var P=r;P<o;P++){var M=e[P];M!=null&&d(t,M,c,A,g)}}function d(t,e,r,o,c){var g=e.tag;if(typeof g=="string")switch(e.state={},e.attrs!=null&&Ce(e.attrs,e,r),g){case"#":y(t,e,c);break;case"<":x(t,e,o,c);break;case"[":w(t,e,r,o,c);break;default:E(t,e,r,o,c)}else C(t,e,r,o,c)}function y(t,e,r){e.dom=n.createTextNode(e.children),Z(t,e.dom,r)}var v={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function x(t,e,r,o){var c=e.children.match(/^\s*?<(\w+)/im)||[],g=n.createElement(v[c[1]]||"div");r==="http://www.w3.org/2000/svg"?(g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e.children+"</svg>",g=g.firstChild):g.innerHTML=e.children,e.dom=g.firstChild,e.domSize=g.childNodes.length,e.instance=[];for(var A=n.createDocumentFragment(),P;P=g.firstChild;)e.instance.push(P),A.appendChild(P);Z(t,A,o)}function w(t,e,r,o,c){var g=n.createDocumentFragment();if(e.children!=null){var A=e.children;l(g,A,0,A.length,r,null,o)}e.dom=g.firstChild,e.domSize=g.childNodes.length,Z(t,g,c)}function E(t,e,r,o,c){var g=e.tag,A=e.attrs,P=A&&A.is;o=m(e)||o;var M=o?P?n.createElementNS(o,g,{is:P}):n.createElementNS(o,g):P?n.createElement(g,{is:P}):n.createElement(g);if(e.dom=M,A!=null&&Kt(e,A,o),Z(t,M,c),!ee(e)&&(e.text!=null&&(e.text!==""?M.textContent=e.text:e.children=[ae("#",void 0,void 0,e.text,void 0,void 0)]),e.children!=null)){var T=e.children;l(M,T,0,T.length,r,null,o),e.tag==="select"&&A!=null&&Wt(e,A)}}function b(t,e){var r;if(typeof t.tag.view=="function"){if(t.state=Object.create(t.tag),r=t.state.view,r.$$reentrantLock$$!=null)return;r.$$reentrantLock$$=!0}else{if(t.state=void 0,r=t.tag,r.$$reentrantLock$$!=null)return;r.$$reentrantLock$$=!0,t.state=t.tag.prototype!=null&&typeof t.tag.prototype.view=="function"?new t.tag(t):t.tag(t)}if(Ce(t.state,t,e),t.attrs!=null&&Ce(t.attrs,t,e),t.instance=ae.normalize(h.call(t.state.view,t)),t.instance===t)throw Error("A view cannot return the vnode it received as argument");r.$$reentrantLock$$=null}function C(t,e,r,o,c){b(e,r),e.instance!=null?(d(t,e.instance,r,o,c),e.dom=e.instance.dom,e.domSize=e.dom!=null?e.instance.domSize:0):e.domSize=0}function R(t,e,r,o,c,g){if(!(e===r||e==null&&r==null))if(e==null||e.length===0)l(t,r,0,r.length,o,c,g);else if(r==null||r.length===0)B(t,e,0,e.length);else{var A=e[0]!=null&&e[0].key!=null,P=r[0]!=null&&r[0].key!=null,M=0,T=0;if(!A)for(;T<e.length&&e[T]==null;)T++;if(!P)for(;M<r.length&&r[M]==null;)M++;if(P===null&&A==null)return;if(A!==P)B(t,e,T,e.length),l(t,r,M,r.length,o,c,g);else if(P){for(var F=e.length-1,$=r.length-1,he,_,V,I,D,Re;F>=T&&$>=M&&(I=e[F],D=r[$],I.key===D.key);)I!==D&&L(t,I,D,o,c,g),D.dom!=null&&(c=D.dom),F--,$--;for(;F>=T&&$>=M&&(_=e[T],V=r[M],_.key===V.key);)T++,M++,_!==V&&L(t,_,V,o,U(e,T,c),g);for(;F>=T&&$>=M&&!(M===$||_.key!==D.key||I.key!==V.key);)Re=U(e,T,c),G(t,I,Re),I!==V&&L(t,I,V,o,Re,g),++M<=--$&&G(t,_,c),_!==D&&L(t,_,D,o,c,g),D.dom!=null&&(c=D.dom),T++,F--,I=e[F],D=r[$],_=e[T],V=r[M];for(;F>=T&&$>=M&&I.key===D.key;)I!==D&&L(t,I,D,o,c,g),D.dom!=null&&(c=D.dom),F--,$--,I=e[F],D=r[$];if(M>$)B(t,e,T,F+1);else if(T>F)l(t,r,M,$+1,o,c,g);else{var tr=c,Xe=$-M+1,se=new Array(Xe),Te=0,z=0,qe=2147483647,De=0,he,Oe;for(z=0;z<Xe;z++)se[z]=-1;for(z=$;z>=M;z--){he==null&&(he=K(e,T,F+1)),D=r[z];var ie=he[D.key];ie!=null&&(qe=ie<qe?ie:-1,se[z-M]=ie,I=e[ie],e[ie]=null,I!==D&&L(t,I,D,o,c,g),D.dom!=null&&(c=D.dom),De++)}if(c=tr,De!==F-T+1&&B(t,e,T,F+1),De===0)l(t,r,M,$+1,o,c,g);else if(qe===-1)for(Oe=Q(se),Te=Oe.length-1,z=$;z>=M;z--)V=r[z],se[z-M]===-1?d(t,V,o,g,c):Oe[Te]===z-M?Te--:G(t,V,c),V.dom!=null&&(c=r[z].dom);else for(z=$;z>=M;z--)V=r[z],se[z-M]===-1&&d(t,V,o,g,c),V.dom!=null&&(c=r[z].dom)}}else{var Pe=e.length<r.length?e.length:r.length;for(M=M<T?M:T;M<Pe;M++)_=e[M],V=r[M],!(_===V||_==null&&V==null)&&(_==null?d(t,V,o,g,U(e,M+1,c)):V==null?fe(t,_):L(t,_,V,o,U(e,M+1,c),g));e.length>Pe&&B(t,e,M,e.length),r.length>Pe&&l(t,r,M,r.length,o,c,g)}}}function L(t,e,r,o,c,g){var A=e.tag,P=r.tag;if(A===P){if(r.state=e.state,r.events=e.events,er(r,e))return;if(typeof A=="string")switch(r.attrs!=null&&Ae(r.attrs,r,o),A){case"#":X(e,r);break;case"<":W(t,e,r,g,c);break;case"[":N(t,e,r,o,c,g);break;default:q(e,r,o,g)}else k(t,e,r,o,c,g)}else fe(t,e),d(t,r,o,g,c)}function X(t,e){t.children.toString()!==e.children.toString()&&(t.dom.nodeValue=e.children),e.dom=t.dom}function W(t,e,r,o,c){e.children!==r.children?(Ge(t,e),x(t,r,o,c)):(r.dom=e.dom,r.domSize=e.domSize,r.instance=e.instance)}function N(t,e,r,o,c,g){R(t,e.children,r.children,o,c,g);var A=0,P=r.children;if(r.dom=null,P!=null){for(var M=0;M<P.length;M++){var T=P[M];T!=null&&T.dom!=null&&(r.dom==null&&(r.dom=T.dom),A+=T.domSize||1)}A!==1&&(r.domSize=A)}}function q(t,e,r,o){var c=e.dom=t.dom;o=m(e)||o,e.tag==="textarea"&&(e.attrs==null&&(e.attrs={}),e.text!=null&&(e.attrs.value=e.text,e.text=void 0)),Yt(e,t.attrs,e.attrs,o),ee(e)||(t.text!=null&&e.text!=null&&e.text!==""?t.text.toString()!==e.text.toString()&&(t.dom.firstChild.nodeValue=e.text):(t.text!=null&&(t.children=[ae("#",void 0,void 0,t.text,void 0,t.dom.firstChild)]),e.text!=null&&(e.children=[ae("#",void 0,void 0,e.text,void 0,void 0)]),R(c,t.children,e.children,r,null,o)))}function k(t,e,r,o,c,g){if(r.instance=ae.normalize(h.call(r.state.view,r)),r.instance===r)throw Error("A view cannot return the vnode it received as argument");Ae(r.state,r,o),r.attrs!=null&&Ae(r.attrs,r,o),r.instance!=null?(e.instance==null?d(t,r.instance,o,g,c):L(t,e.instance,r.instance,o,c,g),r.dom=r.instance.dom,r.domSize=r.instance.domSize):e.instance!=null?(fe(t,e.instance),r.dom=void 0,r.domSize=0):(r.dom=e.dom,r.domSize=e.domSize)}function K(t,e,r){for(var o=Object.create(null);e<r;e++){var c=t[e];if(c!=null){var g=c.key;g!=null&&(o[g]=e)}}return o}var H=[];function Q(t){for(var e=[0],r=0,o=0,c=0,g=H.length=t.length,c=0;c<g;c++)H[c]=t[c];for(var c=0;c<g;++c)if(t[c]!==-1){var A=e[e.length-1];if(t[A]<t[c]){H[c]=A,e.push(c);continue}for(r=0,o=e.length-1;r<o;){var P=(r>>>1)+(o>>>1)+(r&o&1);t[e[P]]<t[c]?r=P+1:o=P}t[c]<t[e[r]]&&(r>0&&(H[c]=e[r-1]),e[r]=c)}for(r=e.length,o=e[r-1];r-- >0;)e[r]=o,o=H[o];return H.length=0,e}function U(t,e,r){for(;e<t.length;e++)if(t[e]!=null&&t[e].dom!=null)return t[e].dom;return r}function G(t,e,r){var o=n.createDocumentFragment();le(t,o,e),Z(t,o,r)}function le(t,e,r){for(;r.dom!=null&&r.dom.parentNode===t;){if(typeof r.tag!="string"){if(r=r.instance,r!=null)continue}else if(r.tag==="<")for(var o=0;o<r.instance.length;o++)e.appendChild(r.instance[o]);else if(r.tag!=="[")e.appendChild(r.dom);else if(r.children.length===1){if(r=r.children[0],r!=null)continue}else for(var o=0;o<r.children.length;o++){var c=r.children[o];c!=null&&le(t,e,c)}break}}function Z(t,e,r){r!=null?t.insertBefore(e,r):t.appendChild(e)}function ee(t){if(t.attrs==null||t.attrs.contenteditable==null&&t.attrs.contentEditable==null)return!1;var e=t.children;if(e!=null&&e.length===1&&e[0].tag==="<"){var r=e[0].children;t.dom.innerHTML!==r&&(t.dom.innerHTML=r)}else if(t.text!=null||e!=null&&e.length!==0)throw new Error("Child node of a contenteditable must be trusted");return!0}function B(t,e,r,o){for(var c=r;c<o;c++){var g=e[c];g!=null&&fe(t,g)}}function fe(t,e){var r=0,o=e.state,c,g;if(typeof e.tag!="string"&&typeof e.state.onbeforeremove=="function"){var A=h.call(e.state.onbeforeremove,e);A!=null&&typeof A.then=="function"&&(r=1,c=A)}if(e.attrs&&typeof e.attrs.onbeforeremove=="function"){var A=h.call(e.attrs.onbeforeremove,e);A!=null&&typeof A.then=="function"&&(r|=2,g=A)}if(u(e,o),!r)ue(e),be(t,e);else{if(c!=null){var P=function(){r&1&&(r&=2,r||M())};c.then(P,P)}if(g!=null){var P=function(){r&2&&(r&=1,r||M())};g.then(P,P)}}function M(){u(e,o),ue(e),be(t,e)}}function Ge(t,e){for(var r=0;r<e.instance.length;r++)t.removeChild(e.instance[r])}function be(t,e){for(;e.dom!=null&&e.dom.parentNode===t;){if(typeof e.tag!="string"){if(e=e.instance,e!=null)continue}else if(e.tag==="<")Ge(t,e);else{if(e.tag!=="["&&(t.removeChild(e.dom),!Array.isArray(e.children)))break;if(e.children.length===1){if(e=e.children[0],e!=null)continue}else for(var r=0;r<e.children.length;r++){var o=e.children[r];o!=null&&be(t,o)}}break}}function ue(t){if(typeof t.tag!="string"&&typeof t.state.onremove=="function"&&h.call(t.state.onremove,t),t.attrs&&typeof t.attrs.onremove=="function"&&h.call(t.attrs.onremove,t),typeof t.tag!="string")t.instance!=null&&ue(t.instance);else{var e=t.children;if(Array.isArray(e))for(var r=0;r<e.length;r++){var o=e[r];o!=null&&ue(o)}}}function Kt(t,e,r){for(var o in e)ve(t,o,null,e[o],r)}function ve(t,e,r,o,c){if(!(e==="key"||e==="is"||o==null||xe(e)||r===o&&!Jt(t,e)&&typeof o!="object")){if(e[0]==="o"&&e[1]==="n")return Ke(t,e,o);if(e.slice(0,6)==="xlink:")t.dom.setAttributeNS("http://www.w3.org/1999/xlink",e.slice(6),o);else if(e==="style")Be(t.dom,r,o);else if(Ue(t,e,c)){if(e==="value"&&((t.tag==="input"||t.tag==="textarea")&&t.dom.value===""+o&&t.dom===f()||t.tag==="select"&&r!==null&&t.dom.value===""+o||t.tag==="option"&&r!==null&&t.dom.value===""+o))return;t.tag==="input"&&e==="type"?t.dom.setAttribute(e,o):t.dom[e]=o}else typeof o=="boolean"?o?t.dom.setAttribute(e,""):t.dom.removeAttribute(e):t.dom.setAttribute(e==="className"?"class":e,o)}}function Xt(t,e,r,o){if(!(e==="key"||e==="is"||r==null||xe(e)))if(e[0]==="o"&&e[1]==="n"&&!xe(e))Ke(t,e,void 0);else if(e==="style")Be(t.dom,r,null);else if(Ue(t,e,o)&&e!=="className"&&!(e==="value"&&(t.tag==="option"||t.tag==="select"&&t.dom.selectedIndex===-1&&t.dom===f()))&&!(t.tag==="input"&&e==="type"))t.dom[e]=null;else{var c=e.indexOf(":");c!==-1&&(e=e.slice(c+1)),r!==!1&&t.dom.removeAttribute(e==="className"?"class":e)}}function Wt(t,e){if("value"in e)if(e.value===null)t.dom.selectedIndex!==-1&&(t.dom.value=null);else{var r=""+e.value;(t.dom.value!==r||t.dom.selectedIndex===-1)&&(t.dom.value=r)}"selectedIndex"in e&&ve(t,"selectedIndex",null,e.selectedIndex,void 0)}function Yt(t,e,r,o){if(r!=null)for(var c in r)ve(t,c,e&&e[c],r[c],o);var g;if(e!=null)for(var c in e)(g=e[c])!=null&&(r==null||r[c]==null)&&Xt(t,c,g,o)}function Jt(t,e){return e==="value"||e==="checked"||e==="selectedIndex"||e==="selected"&&t.dom===f()||t.tag==="option"&&t.dom.parentNode===n.activeElement}function xe(t){return t==="oninit"||t==="oncreate"||t==="onupdate"||t==="onremove"||t==="onbeforeremove"||t==="onbeforeupdate"}function Ue(t,e,r){return r===void 0&&(t.tag.indexOf("-")>-1||t.attrs!=null&&t.attrs.is||e!=="href"&&e!=="list"&&e!=="form"&&e!=="width"&&e!=="height")&&e in t.dom}var Qt=/[A-Z]/g;function Zt(t){return"-"+t.toLowerCase()}function Ee(t){return t[0]==="-"&&t[1]==="-"?t:t==="cssFloat"?"float":t.replace(Qt,Zt)}function Be(t,e,r){if(e!==r)if(r==null)t.style.cssText="";else if(typeof r!="object")t.style.cssText=r;else if(e==null||typeof e!="object"){t.style.cssText="";for(var o in r){var c=r[o];c!=null&&t.style.setProperty(Ee(o),String(c))}}else{for(var o in r){var c=r[o];c!=null&&(c=String(c))!==String(e[o])&&t.style.setProperty(Ee(o),c)}for(var o in e)e[o]!=null&&r[o]==null&&t.style.removeProperty(Ee(o))}}function Me(){this._=a}Me.prototype=Object.create(null),Me.prototype.handleEvent=function(t){var e=this["on"+t.type],r;typeof e=="function"?r=e.call(t.currentTarget,t):typeof e.handleEvent=="function"&&e.handleEvent(t),this._&&t.redraw!==!1&&(0,this._)(),r===!1&&(t.preventDefault(),t.stopPropagation())};function Ke(t,e,r){if(t.events!=null){if(t.events[e]===r)return;r!=null&&(typeof r=="function"||typeof r=="object")?(t.events[e]==null&&t.dom.addEventListener(e.slice(2),t.events,!1),t.events[e]=r):(t.events[e]!=null&&t.dom.removeEventListener(e.slice(2),t.events,!1),t.events[e]=void 0)}else r!=null&&(typeof r=="function"||typeof r=="object")&&(t.events=new Me,t.dom.addEventListener(e.slice(2),t.events,!1),t.events[e]=r)}function Ce(t,e,r){typeof t.oninit=="function"&&h.call(t.oninit,e),typeof t.oncreate=="function"&&r.push(h.bind(t.oncreate,e))}function Ae(t,e,r){typeof t.onupdate=="function"&&r.push(h.bind(t.onupdate,e))}function er(t,e){do{if(t.attrs!=null&&typeof t.attrs.onbeforeupdate=="function"){var r=h.call(t.attrs.onbeforeupdate,t,e);if(r!==void 0&&!r)break}if(typeof t.tag!="string"&&typeof t.state.onbeforeupdate=="function"){var r=h.call(t.state.onbeforeupdate,t,e);if(r!==void 0&&!r)break}return!1}while(!1);return t.dom=e.dom,t.domSize=e.domSize,t.instance=e.instance,t.attrs=e.attrs,t.children=e.children,t.text=e.text,!0}return function(t,e,r){if(!t)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var o=[],c=f(),g=t.namespaceURI;t.vnodes==null&&(t.textContent=""),e=ae.normalizeChildren(Array.isArray(e)?e:[e]);var A=a;try{a=typeof r=="function"?r:void 0,R(t,t.vnodes,e,o,null,g==="http://www.w3.org/1999/xhtml"?void 0:g)}finally{a=A}t.vnodes=e,c!=null&&f()!==c&&typeof c.focus=="function"&&c.focus();for(var P=0;P<o.length;P++)o[P]()}}});var ke=O((Kr,pt)=>{"use strict";pt.exports=ht()(window)});var gt=O((Xr,dt)=>{"use strict";var mt=Y();dt.exports=function(i,n,a){var s=[],m=!1,u=!1;function h(){if(m)throw new Error("Nested m.redraw.sync() call");m=!0;for(var d=0;d<s.length;d+=2)try{i(s[d],mt(s[d+1]),f)}catch(y){a.error(y)}m=!1}function f(){u||(u=!0,n(function(){u=!1,h()}))}f.sync=h;function l(d,y){if(y!=null&&y.view==null&&typeof y!="function")throw new TypeError("m.mount(element, component) expects a component, not a vnode");var v=s.indexOf(d);v>=0&&(s.splice(v,2),i(d,[],f)),y!=null&&(s.push(d,y),i(d,mt(y),f))}return{mount:l,redraw:f}}});var de=O((Wr,yt)=>{"use strict";var br=ke();yt.exports=gt()(br,requestAnimationFrame,console)});var Ie=O((Yr,wt)=>{"use strict";wt.exports=function(i){if(Object.prototype.toString.call(i)!=="[object Object]")return"";var n=[];for(var a in i)s(a,i[a]);return n.join("&");function s(m,u){if(Array.isArray(u))for(var h=0;h<u.length;h++)s(m+"["+h+"]",u[h]);else if(Object.prototype.toString.call(u)==="[object Object]")for(var h in u)s(m+"["+h+"]",u[h]);else n.push(encodeURIComponent(m)+(u!=null&&u!==""?"="+encodeURIComponent(u):""))}}});var je=O((Jr,bt)=>{"use strict";bt.exports=Object.assign||function(i,n){n&&Object.keys(n).forEach(function(a){i[a]=n[a]})}});var ge=O((Qr,vt)=>{"use strict";var vr=Ie(),xr=je();vt.exports=function(i,n){if(/:([^\/\.-]+)(\.{3})?:/.test(i))throw new SyntaxError("Template parameter names *must* be separated");if(n==null)return i;var a=i.indexOf("?"),s=i.indexOf("#"),m=s<0?i.length:s,u=a<0?m:a,h=i.slice(0,u),f={};xr(f,n);var l=h.replace(/:([^\/\.-]+)(\.{3})?/g,function(b,C,R){return delete f[C],n[C]==null?b:R?n[C]:encodeURIComponent(String(n[C]))}),d=l.indexOf("?"),y=l.indexOf("#"),v=y<0?l.length:y,x=d<0?v:d,w=l.slice(0,x);a>=0&&(w+=i.slice(a,m)),d>=0&&(w+=(a<0?"?":"&")+l.slice(d,v));var E=vr(f);return E&&(w+=(a<0&&d<0?"?":"&")+E),s>=0&&(w+=i.slice(s)),y>=0&&(w+=(s<0?"":"&")+l.slice(y)),w}});var Et=O((Zr,xt)=>{"use strict";var Er=ge();xt.exports=function(i,n,a){var s=0;function m(f){return new n(f)}m.prototype=n.prototype,m.__proto__=n;function u(f){return function(l,d){typeof l!="string"?(d=l,l=l.url):d==null&&(d={});var y=new n(function(E,b){f(Er(l,d.params),d,function(C){if(typeof d.type=="function")if(Array.isArray(C))for(var R=0;R<C.length;R++)C[R]=new d.type(C[R]);else C=new d.type(C);E(C)},b)});if(d.background===!0)return y;var v=0;function x(){--v==0&&typeof a=="function"&&a()}return w(y);function w(E){var b=E.then;return E.constructor=m,E.then=function(){v++;var C=b.apply(E,arguments);return C.then(x,function(R){if(x(),v===0)throw R}),w(C)},E}}}function h(f,l){for(var d in f.headers)if({}.hasOwnProperty.call(f.headers,d)&&l.test(d))return!0;return!1}return{request:u(function(f,l,d,y){var v=l.method!=null?l.method.toUpperCase():"GET",x=l.body,w=(l.serialize==null||l.serialize===JSON.serialize)&&!(x instanceof i.FormData),E=l.responseType||(typeof l.extract=="function"?"":"json"),b=new i.XMLHttpRequest,C=!1,R=b,L,X=b.abort;b.abort=function(){C=!0,X.call(this)},b.open(v,f,l.async!==!1,typeof l.user=="string"?l.user:void 0,typeof l.password=="string"?l.password:void 0),w&&x!=null&&!h(l,/^content-type$/i)&&b.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof l.deserialize!="function"&&!h(l,/^accept$/i)&&b.setRequestHeader("Accept","application/json, text/*"),l.withCredentials&&(b.withCredentials=l.withCredentials),l.timeout&&(b.timeout=l.timeout),b.responseType=E;for(var W in l.headers)({}).hasOwnProperty.call(l.headers,W)&&b.setRequestHeader(W,l.headers[W]);b.onreadystatechange=function(N){if(!C&&N.target.readyState===4)try{var q=N.target.status>=200&&N.target.status<300||N.target.status===304||/^file:\/\//i.test(f),k=N.target.response,K;if(E==="json"?!N.target.responseType&&typeof l.extract!="function"&&(k=JSON.parse(N.target.responseText)):(!E||E==="text")&&k==null&&(k=N.target.responseText),typeof l.extract=="function"?(k=l.extract(N.target,l),q=!0):typeof l.deserialize=="function"&&(k=l.deserialize(k)),q)d(k);else{try{K=N.target.responseText}catch(Q){K=k}var H=new Error(K);H.code=N.target.status,H.response=k,y(H)}}catch(Q){y(Q)}},typeof l.config=="function"&&(b=l.config(b,l,f)||b,b!==R&&(L=b.abort,b.abort=function(){C=!0,L.call(this)})),x==null?b.send():typeof l.serialize=="function"?b.send(l.serialize(x)):x instanceof i.FormData?b.send(x):b.send(JSON.stringify(x))}),jsonp:u(function(f,l,d,y){var v=l.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+s++,x=i.document.createElement("script");i[v]=function(w){delete i[v],x.parentNode.removeChild(x),d(w)},x.onerror=function(){delete i[v],x.parentNode.removeChild(x),y(new Error("JSONP request failed"))},x.src=f+(f.indexOf("?")<0?"?":"&")+encodeURIComponent(l.callbackKey||"callback")+"="+encodeURIComponent(v),i.document.documentElement.appendChild(x)})}}});var Ct=O((ei,Mt)=>{"use strict";var Mr=Se(),Cr=de();Mt.exports=Et()(window,Mr,Cr.redraw)});var Fe=O((ti,At)=>{"use strict";At.exports=function(i){if(i===""||i==null)return{};i.charAt(0)==="?"&&(i=i.slice(1));for(var n=i.split("&"),a={},s={},m=0;m<n.length;m++){var u=n[m].split("="),h=decodeURIComponent(u[0]),f=u.length===2?decodeURIComponent(u[1]):"";f==="true"?f=!0:f==="false"&&(f=!1);var l=h.split(/\]\[?|\[/),d=s;h.indexOf("[")>-1&&l.pop();for(var y=0;y<l.length;y++){var v=l[y],x=l[y+1],w=x==""||!isNaN(parseInt(x,10));if(v===""){var h=l.slice(0,y).join();a[h]==null&&(a[h]=Array.isArray(d)?d.length:0),v=a[h]++}else if(v==="__proto__")break;if(y===l.length-1)d[v]=f;else{var E=Object.getOwnPropertyDescriptor(d,v);E!=null&&(E=E.value),E==null&&(d[v]=E=w?[]:{}),d=E}}}return s}});var ye=O((ri,Pt)=>{"use strict";var Ar=Fe();Pt.exports=function(i){var n=i.indexOf("?"),a=i.indexOf("#"),s=a<0?i.length:a,m=n<0?s:n,u=i.slice(0,m).replace(/\/{2,}/g,"/");return u?(u[0]!=="/"&&(u="/"+u),u.length>1&&u[u.length-1]==="/"&&(u=u.slice(0,-1))):u="/",{path:u,params:n<0?{}:Ar(i.slice(n+1,s))}}});var Tt=O((ii,Rt)=>{"use strict";var Pr=ye();Rt.exports=function(i){var n=Pr(i),a=Object.keys(n.params),s=[],m=new RegExp("^"+n.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(u,h,f){return h==null?"\\"+u:(s.push({k:h,r:f==="..."}),f==="..."?"(.*)":f==="."?"([^/]+)\\.":"([^/]+)"+(f||""))})+"$");return function(u){for(var h=0;h<a.length;h++)if(n.params[a[h]]!==u.params[a[h]])return!1;if(!s.length)return m.test(u.path);var f=m.exec(u.path);if(f==null)return!1;for(var h=0;h<s.length;h++)u.params[s[h].k]=s[h].r?f[h+1]:decodeURIComponent(f[h+1]);return!0}}});var zt=O((ni,Ot)=>{"use strict";var Rr=Y(),Tr=Ve(),qr=Se(),Dr=ge(),qt=ye(),Or=Tt(),Dt=je(),_e={};Ot.exports=function(i,n){var a;function s(v,x,w){if(v=Dr(v,x),a!=null){a();var E=w?w.state:null,b=w?w.title:null;w&&w.replace?i.history.replaceState(E,b,y.prefix+v):i.history.pushState(E,b,y.prefix+v)}else i.location.href=y.prefix+v}var m=_e,u,h,f,l,d=y.SKIP={};function y(v,x,w){if(v==null)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var E=0,b=Object.keys(w).map(function(q){if(q[0]!=="/")throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(q))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:q,component:w[q],check:Or(q)}}),C=typeof setImmediate=="function"?setImmediate:setTimeout,R=qr.resolve(),L=!1,X;if(a=null,x!=null){var W=qt(x);if(!b.some(function(q){return q.check(W)}))throw new ReferenceError("Default route doesn't match any known routes")}function N(){L=!1;var q=i.location.hash;y.prefix[0]!=="#"&&(q=i.location.search+q,y.prefix[0]!=="?"&&(q=i.location.pathname+q,q[0]!=="/"&&(q="/"+q)));var k=q.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(y.prefix.length),K=qt(k);Dt(K.params,i.history.state);function H(){if(k===x)throw new Error("Could not resolve default route "+x);s(x,null,{replace:!0})}Q(0);function Q(U){for(;U<b.length;U++)if(b[U].check(K)){var G=b[U].component,le=b[U].route,Z=G,ee=l=function(B){if(ee===l){if(B===d)return Q(U+1);u=B!=null&&(typeof B.view=="function"||typeof B=="function")?B:"div",h=K.params,f=k,l=null,m=G.render?G:null,E===2?n.redraw():(E=2,n.redraw.sync())}};G.view||typeof G=="function"?(G={},ee(Z)):G.onmatch?R.then(function(){return G.onmatch(K.params,k,le)}).then(ee,H):ee("div");return}H()}}return a=function(){L||(L=!0,C(N))},typeof i.history.pushState=="function"?(X=function(){i.removeEventListener("popstate",a,!1)},i.addEventListener("popstate",a,!1)):y.prefix[0]==="#"&&(a=null,X=function(){i.removeEventListener("hashchange",N,!1)},i.addEventListener("hashchange",N,!1)),n.mount(v,{onbeforeupdate:function(){return E=E?2:1,!(!E||_e===m)},oncreate:N,onremove:X,view:function(){if(!(!E||_e===m)){var q=[Rr(u,h.key,h)];return m&&(q=m.render(q[0])),q}}})}return y.set=function(v,x,w){l!=null&&(w=w||{},w.replace=!0),l=null,s(v,x,w)},y.get=function(){return f},y.prefix="#!",y.Link={view:function(v){var x=v.attrs.options,w={},E,b;Dt(w,v.attrs),w.selector=w.options=w.key=w.oninit=w.oncreate=w.onbeforeupdate=w.onupdate=w.onbeforeremove=w.onremove=null;var C=Tr(v.attrs.selector||"a",w,v.children);return(C.attrs.disabled=Boolean(C.attrs.disabled))?(C.attrs.href=null,C.attrs["aria-disabled"]="true",C.attrs.onclick=null):(E=C.attrs.onclick,b=C.attrs.href,C.attrs.href=y.prefix+b,C.attrs.onclick=function(R){var L;typeof E=="function"?L=E.call(R.currentTarget,R):E==null||typeof E!="object"||typeof E.handleEvent=="function"&&E.handleEvent(R),L!==!1&&!R.defaultPrevented&&(R.button===0||R.which===0||R.which===1)&&(!R.currentTarget.target||R.currentTarget.target==="_self")&&!R.ctrlKey&&!R.metaKey&&!R.shiftKey&&!R.altKey&&(R.preventDefault(),R.redraw=!1,y.set(b,null,x))}),C}},y.param=function(v){return h&&v!=null?h[v]:h},y}});var Vt=O((ai,Lt)=>{"use strict";var zr=de();Lt.exports=zt()(window,zr)});var kt=O((si,St)=>{"use strict";var we=lt(),Nt=Ct(),$t=de(),j=function(){return we.apply(this,arguments)};j.m=we;j.trust=we.trust;j.fragment=we.fragment;j.mount=$t.mount;j.route=Vt();j.render=ke();j.redraw=$t.redraw;j.request=Nt.request;j.jsonp=Nt.jsonp;j.parseQueryString=Fe();j.buildQueryString=Ie();j.parsePathname=ye();j.buildPathname=ge();j.vnode=Y();j.PromisePolyfill=$e();St.exports=j});var p=lr(kt()),Lr=10,He=Math.floor(1e3/Lr);function Vr(i){let n=Math.floor(i/1e3),a=Math.floor(n/60),s=n%60,m=`${s<10?"0":""}${s}`;return`${a>0?`${a<10?"0":""}${a}`:"00"}:${m}`}function Nr(i){return i<1024?"1 KB":(i=Math.round(i/1024),i<1024?`${i} KB`:`${Math.floor(i/1024*100)/100} MB`)}function re(i,n,a=0,s=i.length-1){let m=s-a;if(m===0)return a;if(m===1)return n<i[s].timestamp?a:s;let u=Math.floor((s+a)/2),h=i[u].timestamp;return n===h?u:n<h?re(i,n,a,u):re(i,n,u,s)}var J={view(i){return i.attrs.a?(0,p.default)("a",ze({class:`button ${i.attrs.primary?"primary":"secondary"} ${i.attrs.label?"":"icon-only"} ${i.attrs.outline?"outline":""}`},i.attrs.a),[(0,p.default)("img",{src:`https://icongr.am/${i.attrs.iconset||"octicons"}/${i.attrs.icon}.svg?size=16&color=${i.attrs.outline?"333333":"ffffff"}`}),i.attrs.label]):(0,p.default)("button",{class:`button ${i.attrs.primary?"primary":"secondary"} ${i.attrs.label?"":"icon-only"} ${i.attrs.outline?"outline":""}`,onclick:i.attrs.onclick,title:i.attrs.title||i.attrs.label,disabled:i.attrs.disabled},[(0,p.default)("img",{src:`https://icongr.am/${i.attrs.iconset||"octicons"}/${i.attrs.icon}.svg?size=16&color=${i.attrs.outline?"333333":"ffffff"}`}),i.attrs.label])}},It={view(i){return(0,p.default)("span.tag.is-small",[(0,p.default)("img",{src:"https://icongr.am/octicons/clock.svg?size=16&color=333333"}),Vr(i.attrs.duration)])}},ce={view(i){return(0,p.default)("section",{class:"view"},[(0,p.default)("section",ze({class:`content ${i.attrs.contentClass||""}`},i.attrs.contentProps||{}),i.children),(0,p.default)("section",{class:"actions"},i.attrs.actions)])}},jt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Ft=class{constructor(n){this.app=n.attrs.app}view(){return(0,p.default)(ce,[(0,p.default)("p","Create animated GIFs from a screen recording."),(0,p.default)("p","Client-side only, no data is uploaded. Modern browser required."),jt?(0,p.default)("p","Sorry, mobile does not support screen recording."):void 0,jt?void 0:(0,p.default)(J,{label:"Start Recording",icon:"play",onclick:()=>this.app.startRecording(),primary:!0})])}},_t=class{constructor(n){this.app=n.attrs.app,this.gif=n.attrs.gif}view(){let n=[(0,p.default)(J,{label:"Download",icon:"download",a:{href:this.gif.url,download:"recording.gif",target:"_blank"},primary:!0}),(0,p.default)(J,{label:"Edit",icon:"pencil",onclick:()=>this.app.editGif()}),(0,p.default)(J,{label:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,p.default)(ce,{actions:n},(0,p.default)(".recording-card",[(0,p.default)("a",{href:this.gif.url,download:"recording.gif",target:"_blank"},[(0,p.default)("img.recording",{src:this.gif.url})]),(0,p.default)("footer",[(0,p.default)(It,{duration:this.gif.duration}),(0,p.default)("span.tag.is-small",[(0,p.default)("a.recording-detail",{href:this.gif.url,download:"recording.gif",target:"_blank"},[(0,p.default)("img",{src:"https://icongr.am/octicons/download.svg?size=16&color=333333"}),Nr(this.gif.size)])])])]))]}},Ht=class{constructor(n){this.startTime=0;this.width=0;this.height=0;this.frames=[];this.app=n.attrs.app,this.captureStream=n.attrs.captureStream}async oncreate(n){let a=n.dom.getElementsByTagName("video")[0],s=n.dom.getElementsByTagName("canvas")[0];a.srcObject=this.captureStream;let m=s.getContext("2d"),u=new Worker("/dist/ticker.js");u.onmessage=()=>{if(a.videoWidth===0)return;let d=this.startTime===0;if(d){let v=a.videoWidth,x=a.videoHeight;this.startTime=Date.now(),this.width=v,this.height=x,s.width=v,s.height=x}m.drawImage(a,0,0);let y=m.getImageData(0,0,this.width,this.height);this.frames.push({imageData:y,timestamp:d?0:Date.now()-this.startTime})};let h=setInterval(()=>p.default.redraw(),100),f=this.captureStream.getVideoTracks()[0],l=()=>this.stopRecording();f.addEventListener("ended",l),this._onbeforeremove=()=>{u.terminate(),clearInterval(h),f.removeEventListener("ended",l),f.stop()},p.default.redraw()}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}view(){return[(0,p.default)(ce,[(0,p.default)("p",[(0,p.default)(It,{duration:this.startTime===0?0:Date.now()-this.startTime})]),(0,p.default)(J,{label:"Stop Recording",icon:"square-fill",onclick:()=>this.stopRecording()}),(0,p.default)("canvas.hidden",{width:640,height:480}),(0,p.default)("video.hidden",{autoplay:!0,playsinline:!0})])]}stopRecording(){this.app.stopRecording({width:this.width,height:this.height,frames:this.frames})}},Gt=class{constructor(n){this.app=n.attrs.app,this.recording=n.attrs.recording,this.duration=this.recording.frames[this.recording.frames.length-1].timestamp+He,this.viewport={width:0,height:0,top:0,left:0,zoom:1},this.playback={head:0,start:0,offset:0,end:this.duration,disposable:void 0},this.trim={start:0,end:this.duration},this.crop={top:0,left:0,width:this.recording.width,height:this.recording.height}}get isPlaying(){return!!this.playback.disposable}async oncreate(n){this.canvas=n.dom.getElementsByTagName("canvas")[0],this.playbar=n.dom.querySelector(".playbar"),this.content=n.dom.querySelector(".content");let a=()=>this.updateViewport();window.addEventListener("resize",a),this.viewportDisposable=()=>window.removeEventListener("resize",a),this.updateViewport(),this.zoomToFit(),p.default.redraw(),setTimeout(()=>this.play())}zoomToFit(){this.viewport.zoom=Math.max(.1,Math.min(1,this.viewport.width*.95/this.recording.width,this.viewport.height*.95/this.recording.height))}updateViewport(){this.viewport.width=Math.floor(this.content.clientWidth),this.viewport.height=Math.floor(this.content.clientHeight)}onbeforeremove(){this.pause(),this.viewportDisposable()}view(){let n=this.crop.top!==0||this.crop.left!==0||this.crop.width!==this.recording.width||this.crop.height!==this.recording.height,a=[(0,p.default)(J,{title:this.isPlaying?"Pause":"Play",iconset:"material",icon:this.isPlaying?"pause":"play",primary:!0,onclick:()=>this.togglePlayPause()}),(0,p.default)(".playbar",[(0,p.default)("input",{type:"range",min:0,max:`${this.duration}`,value:`${this.playback.head}`,disabled:this.isPlaying,oninput:l=>this.onPlaybarInput(l)}),(0,p.default)(".trim-bar",{style:{left:`${this.trim.start*100/this.duration}%`,width:`${(this.trim.end-this.trim.start)*100/this.duration}%`}},[(0,p.default)(".trim-start",{onmousedown:l=>this.onTrimMouseDown("start",l)}),(0,p.default)(".trim-end",{onmousedown:l=>this.onTrimMouseDown("end",l)})])]),(0,p.default)(J,{label:"Render",icon:"gear",onclick:()=>this.app.startRendering({trim:this.trim,crop:this.crop}),primary:!0}),(0,p.default)(J,{title:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})],s=l=>l*this.viewport.zoom,m=s(this.recording.width),u=s(this.recording.height),h=Math.floor(s(this.viewport.top)+this.viewport.height/2-u/2),f=Math.floor(s(this.viewport.left)+this.viewport.width/2-m/2);return[(0,p.default)(ce,{actions:a,contentClass:"crop",contentProps:{onwheel:l=>this.onContentWheel(l),onmousedown:l=>this.onContentMouseDown(l),oncontextmenu:l=>l.preventDefault()}},[(0,p.default)(".preview",{style:{top:`${h}px`,left:`${f}px`,width:`${m}px`,height:`${u}px`}},[(0,p.default)("canvas",{width:this.recording.width,height:this.recording.height}),n&&(0,p.default)(".crop-box",{style:{clipPath:`polygon(evenodd, 0 0, 0 ${s(this.recording.height)}px, ${s(this.recording.width)}% ${s(this.recording.height)}px, ${s(this.recording.width)}% 0, 0 0, ${s(this.crop.left)}px ${s(this.crop.top)}px, ${s(this.crop.left)}px ${s(this.crop.top+this.crop.height)}px, ${s(this.crop.left+this.crop.width)}px ${s(this.crop.top+this.crop.height)}px, ${s(this.crop.left+this.crop.width)}px ${s(this.crop.top)}px, ${s(this.crop.left)}px ${s(this.crop.top)}px)`}})])])]}onTrimMouseDown(n,a){a.preventDefault();let s=this.canvas.getContext("2d"),m={width:this.playbar.clientWidth,screenX:a.screenX,head:n==="start"?this.trim.start:this.trim.end,min:n==="start"?0:this.trim.start+He,max:n==="start"?this.trim.end-He:this.duration},u=f=>{let l=f.screenX-m.screenX,d=m.head+Math.round(l*this.duration/m.width);this.trim[n]=Math.max(m.min,Math.min(m.max,d)),p.default.redraw()},h=()=>{if(document.body.removeEventListener("mousemove",u),document.body.removeEventListener("mouseup",h),this.playback.start=this.trim.start,this.playback.end=this.trim.end,this.isPlaying){this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let f=re(this.recording.frames,this.playback.head);s.putImageData(this.recording.frames[f].imageData,0,0)}p.default.redraw()};document.body.addEventListener("mousemove",u),document.body.addEventListener("mouseup",h)}onContentWheel(n){n.preventDefault();let a=this.viewport.zoom-n.deltaY/180*.1;this.viewport.zoom=Math.max(.1,Math.min(2,a))}onContentMouseDown(n){n.button===0&&!n.ctrlKey&&!n.metaKey&&!n.shiftKey?this.onCrop(n):this.onViewportMove(n)}onCrop(n){let a=this.recording.width*this.viewport.zoom,s=this.recording.height*this.viewport.zoom,m=Math.floor(this.viewport.top*this.viewport.zoom+this.viewport.height/2-s/2),u=Math.floor(this.viewport.left*this.viewport.zoom+this.viewport.width/2-a/2),h=n.currentTarget.offsetTop,f=n.currentTarget.offsetLeft,l=b=>Math.max(0,Math.min(this.recording.height,(b.clientY-h-m)/this.viewport.zoom)),d=b=>Math.max(0,Math.min(this.recording.width,(b.clientX-f-u)/this.viewport.zoom)),y=b=>({top:Math.round(l(b)),left:Math.round(d(b))}),v=y(n),x=!1,w=b=>{let C=y(b),R=Math.max(0,Math.min(v.top,C.top)),L=Math.max(0,Math.min(v.left,C.left)),X=Math.min(this.recording.width-L,Math.abs(v.left-C.left)),W=Math.min(this.recording.height-R,Math.abs(v.top-C.top));this.crop={top:R,left:L,width:X,height:W},x=!0,p.default.redraw()},E=b=>{b.preventDefault(),document.body.removeEventListener("mousemove",w),document.body.removeEventListener("mouseup",E),(!x||this.crop.width<10||this.crop.height<10)&&(this.crop={top:0,left:0,width:this.recording.width,height:this.recording.height}),p.default.redraw()};n.preventDefault(),document.body.addEventListener("mousemove",w),document.body.addEventListener("mouseup",E)}onViewportMove(n){let a={top:this.viewport.top,left:this.viewport.left,screenX:n.screenX,screenY:n.screenY},s=u=>{this.viewport.top=a.top+(u.screenY-a.screenY)/this.viewport.zoom,this.viewport.left=a.left+(u.screenX-a.screenX)/this.viewport.zoom,p.default.redraw()},m=u=>{u.preventDefault(),document.body.removeEventListener("mousemove",s),document.body.removeEventListener("mouseup",m),p.default.redraw()};n.preventDefault(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",m)}onPlaybarInput(n){this.playback.head=n.target.valueAsNumber;let a=this.canvas.getContext("2d"),s=re(this.recording.frames,this.playback.head);a.putImageData(this.recording.frames[s].imageData,0,0)}play(){this.playback.disposable&&this.playback.disposable();let n=this.canvas.getContext("2d"),a,s;this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let m=()=>{this.playback.head=this.playback.start+(Date.now()-this.playback.offset)%(this.playback.end-this.playback.start);let u=re(this.recording.frames,this.playback.head);a!==u&&n.putImageData(this.recording.frames[u].imageData,0,0),a=u,p.default.redraw(),s=requestAnimationFrame(m)};s=requestAnimationFrame(m),this.playback.disposable=()=>{typeof s!="undefined"&&cancelAnimationFrame(s)}}pause(){this.playback.disposable&&(this.playback.disposable(),this.playback.disposable=void 0)}togglePlayPause(){this.isPlaying?this.pause():this.play()}},Ut=class{constructor(n){this.progress=0;this.app=n.attrs.app,this.recording=n.attrs.recording,this.renderOptions=n.attrs.renderOptions}async oncreate(n){let a=new GifEncoder({width:this.renderOptions.crop.width,height:this.renderOptions.crop.height});a.on("progress",f=>{this.progress=f,p.default.redraw()}),a.once("finished",f=>{let l=URL.createObjectURL(f),d=this.renderOptions.trim.end-this.renderOptions.trim.start;this.app.finishRendering({blob:f,url:l,duration:d,size:f.size})});let s=n.dom.getElementsByTagName("canvas")[0].getContext("2d"),m=re(this.recording.frames,this.renderOptions.trim.start),u=re(this.recording.frames,this.renderOptions.trim.end),h=f=>{if(f>u){this._onbeforeremove=()=>a.abort(),a.render();return}let l=this.recording.frames[f],d=l.imageData;s.putImageData(d,0,0),d=s.getImageData(this.renderOptions.crop.left,this.renderOptions.crop.top,this.renderOptions.crop.width,this.renderOptions.crop.height);let y=f<u?this.recording.frames[f+1].timestamp-l.timestamp:100;a.addFrame(d,y),setTimeout(()=>h(f+1),0)};h(m)}view(){let n=[(0,p.default)(J,{label:"Cancel",icon:"square-fill",onclick:()=>this.app.cancelRendering()})];return[(0,p.default)(ce,{actions:n},[(0,p.default)("progress",{max:"1",value:this.progress,title:"Rendering..."},`Rendering: ${Math.floor(this.progress*100)}%`),(0,p.default)("canvas.hidden",{width:this.recording.width,height:this.recording.height})])]}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}},Bt=class{constructor(){this._state={name:"start"};window.onbeforeunload=()=>this.state.name!=="start"?"":null}get state(){return this._state}set state(n){this._state=n,p.default.redraw()}view(){return(0,p.default)("section",{id:"app",class:this.state.name==="start"?"home":""},[(0,p.default)("section",{id:"app-body"},[(0,p.default)("h1",[(0,p.default)("span",{class:"gif"},"gif"),(0,p.default)("span",{class:"cap"},"cap")]),this.body()]),(0,p.default)("footer",{id:"app-footer"},[(0,p.default)("span.left",[(0,p.default)("a",{href:"https://github.com/joaomoreno/gifcap"},[(0,p.default)("img",{alt:"GitHub",src:"https://icongr.am/octicons/mark-github.svg?size=18&color=9e9e9e"})," joaomoreno/gifcap"])]),(0,p.default)("span",[(0,p.default)("a",{title:"Sponsor me!",href:"https://github.com/sponsors/joaomoreno"},[(0,p.default)("img",{alt:"GitHub",src:"https://icongr.am/material/coffee.svg?size=18&color=9e9e9e"})," Like the tool? Sponsor me!"])]),(0,p.default)("span.right",["Made with ",(0,p.default)("img",{alt:"love",src:"https://icongr.am/octicons/heart.svg?size=18&color=9e9e9e"})," by ",(0,p.default)("a",{href:"https://github.com/joaomoreno"},["Jo\xE3o Moreno"])])])])}body(){switch(this.state.name){case"start":return(0,p.default)(Ft,{app:this});case"playing":return(0,p.default)(_t,{app:this,gif:this.state.gif});case"recording":return(0,p.default)(Ht,{app:this,captureStream:this.state.captureStream});case"previewing":return(0,p.default)(Gt,{app:this,recording:this.state.recording});case"rendering":return(0,p.default)(Ut,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions})}}async startRecording(){if(!(this.state.name!=="start"&&!window.confirm("This will discard the current recording, are you sure you want to continue?")))try{let n=await navigator.mediaDevices.getDisplayMedia({video:{width:9999,height:9999}});this.state={name:"recording",captureStream:n},p.default.redraw.sync()}catch(n){console.error(n);return}}stopRecording(n){if(this.state.name!=="recording")throw new Error("Invalid state");this.state={name:"previewing",recording:n}}startRendering(n){if(this.state.name!=="previewing")throw new Error("Invalid state");this.state={name:"rendering",recording:this.state.recording,renderOptions:n}}finishRendering(n){if(this.state.name!=="rendering")throw new Error("Invalid state");this.state={name:"playing",gif:n,recording:this.state.recording}}cancelRendering(){if(this.state.name!=="rendering")throw new Error("Invalid state");this.state={name:"previewing",recording:this.state.recording}}editGif(){if(this.state.name!=="playing")throw new Error("Invalid state");this.state={name:"previewing",recording:this.state.recording}}discardGif(){this.state={name:"start"}}};function $r(){p.default.mount(document.getElementById("app-container"),Bt)}$r();})();
//# sourceMappingURL=main.js.map
